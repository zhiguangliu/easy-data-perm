# 整体架构

数据权限组件为C-S架构。Client端专注于将从Server端获取的权限条件组合进原始查询中，Server端专注于规则的管理，实现了基于角色的数据权限管理。

数据的





# 服务器端设计



# 客户端设计

客户端从服务器拉取用户的权限，这些权限是按照角色分组的。客户端需要将每组内的条件拼装好，各组条件用or连接

# 通用数据权限组件技术设计

数据权限组件就是让上面的这些权限条件可以在界面上配置，然后利用插件将权限条件拼装进待执行的sql中。实现“查询航班”的逻辑与“控制权限”的逻辑分离，在不影响业务查询条件的基础上，实现了对数据权限的控制。

要实现独立的数据权限控制有这么几个难点：              

1. 条件如何管理
   1. 不同的条件如何保存
   2. 不同的关系如何组合
2. 条件如何拼装进基础查询sql

为了解决第一个问题，我们将整个过程抽象成如下模型：

1. 最底层是“数据权限元数据层”。这层定义了需要控制权限的表中那些字段需要控制条件，即sql条件的左值，一般会有多个字段；
2. 第二层是“数据权限层”。这层指定了条件的剩余部分，即sql条件的运算符和右值。按需设置，不是元数据层的所有字段都要设置，多个字段的条件之间是“且”的关系；
3. 第三层是“数据权限角色层”。这一层根据业务需求，对数据权限进行了组合，形成了一个条件组，同组中的数据权限是“或”的关系。
4. 第四层是“用户与角色关系”层，这里将用户关联到角色，多个角色之间的条件是“或”的关系。

为了解决第二个问题，我们引入了阿里的druid，利用他的sql解析功能，将权限条件拼装进原sql中。

## 功能和架构设计

- 数据权限条件要在查询执行之前生效

  数据权限针对的是查询数据的过程，而不是处理数据的过程。所以，要在sql查询之前，对sql进行处理，将权限加进去，而不是在查询到数据之后，再按照权限进行过滤。

- 数据权限的取值要可以动态控制

- 

  

  但是要做出一个可以通用的权限控制系统，有下面几个难点：
  
  1. 

- 列查询权限

# 不控制和授权所有值有什么区别
不控制是更高级别的控制，这个字段对所有人，都是可见的，不会加任何条件。
所有值是相对低级别的控制，是设置在角色上的，可以在对所有人控制权限的基础上，对专门的角色或人设置“所有值”以实现开放权限。

